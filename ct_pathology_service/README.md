# ct_pathology_service

## Краткое описание решения и его назначения

ct_pathology_service — это сервис для автоматического анализа КТ-исследований и классификации пациентов на группы «здоров» / «болен».
Он ориентирован на ускорение первичной диагностики и помощь врачам в принятии решений.

Frontend для работы врачей и исследователей предоставляет:
 - создание и ведение карточек пациентов,
 - загрузка и просмотр их КТ-исследований,
 - получение результата анализа,
 - просмотр тепловых карт (heatmaps), показывающих наиболее подозрительные области.

Backend API для обработки данных и интеграции предоставляет:
 - загрузка исследований,
 - запуск анализа,
 - получение отчетов,
 - работа с историей пациентов.

Дополнительно предоставляется: 
 - Скрипты для пакетного анализа: возможность локально прогнать целую папку со снимками через модель и собрать результаты в таблицу-отчет.

Сервис поднимается локально с помощью Docker и является полностью автономным решением: в него встроена база данных, в которой хранятся пациенты и их исследования.


## Основные возможности и ограничения системы

Возможности:
Бинарная классификация: «здоров» или «болен» (множество патологий).
Хранение истории пациентов и их исследований.
Автоматическая генерация отчетов по результатам анализа.
Визуализация результатов (heatmap для подсветки областей, которые повлияли на решение модели).
REST API для интеграции с внешними системами.
Поддержка локальной и контейнеризированной работы.

Ограничения:
Поддерживаются только КТ исследования.
Модель обучена на ограниченном датасете и решает задачу бинарной классификации, без разделения по конкретным патологиям.
Система предназначена для исследовательского и демонстрационного использования, а не для медицинских диагнозов.

## Системные требования для запуска

 - Операционная система: Linux / macOS / Windows с поддержкой Docker



## Структуру проекта и описание основных файлов

ct_pathology_service/

│

├── backend/                                             # Backend-сервис (FastAPI)

│   ├── app/                                              # Основная логика приложения

│   │   ├── config/                                        # Настройки сервиса

│   │   ├── schemas/                                       # Схемы данных

│   │   ├── ml/                                            # Код модели, предобработка, классификатор

│   │   ├── routers/                                       # Реализация API эндпоинтов

│   │   └── db/                                            # Работа с БД

│   │   └── main.py                                        # Запуск сервиса, точка входа

│   └── Dockerfile                                        # Докерфайл

│   └── requirements.txt                                  # Необходимые python зависимости

│   └── models                                            # Веса обученной модели

│

├── frontend/                                            # Веб-интерфейс

│

├── database/                                            # Скрипт для создания таблиц в БД

│

├── .env.example                                         # Пример конфигурационного файла

├── .env                                                 # Настройки окружения

├── docker-compose.yml                                   # Конфигурация docker-compose

├── CT Pathology Service.postman_collection.json         # Коллекция для postman

└── README.md                                            # Документация

Дополнительно предоставляется архив, в котором содержится скрипт для массового прогона:

progon/

│

├── massive_progon.py             # скрипт для массового прогона

├── test_massive_progon/          # пример папки исходных файлов для теста

├── result.csv                    # пример выходного файла




## Запуск

Скопировать .env.example в .env и заполнить параметры.

Запуск осуществляется через поднятие контейнеров: db, backend, frontend

### CPU:

Сборка:
`docker compose build --no-cache`

Запуск:
`docker compose up -d`

Остановка: 
`docker compose down -v`

### GPU:

Установлены драйверы NVIDIA.

Установлен nvidia-container-toolkit.

Сборка и запуск:

`docker compose -f docker-compose.yml -f docker-compose.gpu.yml --profile gpu up --build`


### После запуска с рекомендуемыми параметрами сервисы будут доступны по адресам:

Frontend: http://localhost:3000

Backend API (FastAPI docs): http://localhost:8000/docs

## Использование

Через веб-интерфейс:
 - Зарегистрировать пациента.
 - Загрузить КТ-исследование.
 - Запустить анализ.
 - Посмотреть результат («здоров» / «болен») и визуализацию.
 - Сохранить историю пациента и отчет.

Через API (пример эндпоинтов):

Patients

GET /api/patients - Список записей пациентов

GET /api/patients/{id} - Получение записи пациента

POST /api/patients - Создание записи пациента

PUT /api/patients/{id} - Редактирование записи пациента

DELETE /api/patients/{id} - Удаление записи пациента



Scans

GET /api/scans — Список исследований

GET /api/scans/?patient_id={patientId} - Получение списка сканов пациента

POST /api/scans — Создание исследования (загрузка файла)

GET /api/scans/{id} — Получение информации об исследовании

GET /api/scans/{id}/file — Скачать исходный бинарник

PUT /api/scans/{id} — Редактирование исследования (description)

POST /api/scans/{id}/analyze — Запустить анализ исследования и получить картинку со снимком, который больше всего повлиял на решение модели

GET /api/scans/{id}/report — Получить JSON-отчёт об исследовании после анализа

DELETE /api/scans/{id} — Удаление исследования

Inference

POST /inference/predict - Получение отчета по исследованию без привязки к пациенту (для массового прогона данных)


Через скрипт:

Можно прогнать папку с исследованиями и получить таблицу-отчет с результатами для каждого файла.

